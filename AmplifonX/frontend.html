<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Tests</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(to bottom, #1a226b, #00ffff);
            color: #fff;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        h1 {
            color: #333;
        }
        h2 {
            color: #555;
        }
        form {
            background-color: #fff;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            width: 100%;
        }
        .logo {
            display: block;
            margin: 20px auto;
            max-width: 200px;
        }
        label {
            display: block;
            margin: 10px 0 5px;
        }
        input[type="text"],
        input[type="email"],
        input[type="password"],
        input[type="number"],
        input[type="date"],
        select {
            width: calc(100% - 20px);
            padding: 10px;
            margin: 5px 0 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background-color: #007bff;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin: 10px;
        }

        button:hover {
            background-color: #0056b3;
        }

        #apiResponses {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            width: 100%;
            margin: 20px 0;
        }
        .alert-box {
            position: fixed;
            top: 20px;
            left: 20px;
            background-color: #fff;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 300px;
            border-left: 5px solid #44ff00;
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
        }
        .alert-box.error {
            border-left-color: #ff0000;
        }
        .alert-box h3 {
            margin: 0 0 10px;
            color: #44ff00;
        }
        .alert-box.error h3 {
            color: #ff0000;
        }
        .alert-box pre {
            margin: 0;
            color: #333;
        }
        .alert-box pre {
            margin: 0;
            color: #333;
        }
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        .clear-db-button {
            background-color: #777777;
            color: white;
            border: none;
            font-weight: bold;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .clear-db-button:hover {
            background-color: #464646;
        }
        .center-button {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        h1, h2, label {
            color: black;
        }
    </style>
</head>
<body>
    <img src="https://upload.wikimedia.org/wikipedia/commons/9/9d/Amplifon-Logo.png" alt="Amplifon Logo" class="logo">

    <h1>AMPLIFONX TEST</h1>
    
    <div class="center-button">
        <button class="button" onclick="clearDatabase()">‚ôªÔ∏è Clear Database</button>
        <button class="button" onclick="exportDatabase()">üì≤ Export Database</button>
    </div>

    <h1>üëÆüèº AUTHENTICATION API üîê</h1>

    <h2>Sign Up</h2>
    <form id="signupForm">
        <label for="Email">Email:*</label>
        <input type="email" id="Email" name="Email" required><br><br>
        
        <label for="Password">Password:*</label>
        <input type="password" id="Password" name="Password" required><br><br>
        
        <label for="Role">Role:</label>
        <select id="Role" name="Role" required>
            <option value="A">Admin</option>
            <option value="S">Seller</option>
            <option value="M">Manager</option>
        </select><br><br>
        <div class="center-button">
             <button type="button" onclick="signUp()">Sign Up</button>
        </div>
    </form>

    <h2>Log in</h2>
    <form id="logInForm">
        <label for="EmailLogin">Email:*</label>
        <input type="email" id="EmailLogin" name="EmailLogin" required><br><br>
        
        <label for="PasswordLogin">Password:*</label>
        <input type="password" id="PasswordLogin" name="PasswordLogin" required><br><br>
        <div class="center-button">
            <button type="button" onclick="login()">Log in</button>
        </div>
    </form>

    <h2>Log out</h2>
    <form id="logoutForm">
        <div class="center-button">
            <button type="button" onclick="logout()">Log out</button>
        </div>
    </form>

    <h1>üè™ STORES API üõçÔ∏è</h1>

    <h2>Insert Store</h2>
    <form id="insertStoreForm">
        <label for="insertStoreName">Store Name:*</label>
        <input type="text" id="insertStoreName" name="insertStoreName" required><br><br>
        <label for="insertStoreCity">Store City:*</label>
        <input type="text" id="insertStoreCity" name="insertStoreCity" required><br><br>
        <div class="center-button">
            <button type="button" onclick="insertStore()">Insert Store</button>
        </div>
    </form>

    <h2>Update Store</h2>
    <form id="updateStoreForm">
        <label for="updateStoreId">Store ID:*</label>
        <input type="text" id="updateStoreId" name="storeId" required><br><br>
        <label for="updateStoreName">New Store Name:*</label>
        <input type="text" id="updateStoreName" name="storeName" required><br><br>
        <label for="updateStoreCity">New Store City:*</label>
        <input type="text" id="updateStoreCity" name="city" required><br><br>
        </div>
        <div class="center-button">
            <button type="button" onclick="updateStore()">Update Store</button>
        </div>
    </form>

    <h2>Delete Store</h2>
    <form id="deleteStoreForm">
        <label for="deleteStoreId">Store ID:*</label>
        <input type="text" id="deleteStoreId" name="deleteStoreId" required><br><br>
        <div class="center-button">
          <button type="button" onclick="deleteStore()">Delete Store</button>
        </div>
    </form>

    <h2>Find One Store</h2>
    <form id="findOneStoreForm">
        <label for="findOneStoreId">Store ID:*</label>
        <input type="text" id="findOneStoreId" name="findOneStoreId" required><br><br>
        <div class="center-button">
            <button type="button" onclick="findOneStore()">Find One Store</button>
        </div>
    </form>

    <h2>Paginated Stores</h2>
    <form id="paginatedStoresForm">
        <label for="paginatedStoresName">Store Name:</label>
        <input type="text" id="paginatedStoresName" name="paginatedStoresName"><br><br>
        <label for="paginatedStoresCity">Store City:</label>
        <input type="text" id="paginatedStoresCity" name="paginatedStoresCity"><br><br>
        <label for="paginatedStoresPage">Page:</label>
        <input type="number" id="paginatedStoresPage" name="paginatedStoresPage" min="1" value="1">
        <label for="paginatedStoresSize">Page Size:</label>
        <input type="number" id="paginatedStoresSize" name="paginatedStoresSize" min="1" value="5"><br><br>
        <div class="center-button">
          <button type="button" onclick="paginatedStores()">Get Paginated Stores</button>
        </div>
    </form>

    <h1>üí∂ SALES API üìà</h1>

    <h2>Create Sale</h2>
    <form id="createSaleForm">
        <label for="createSaleAmount">Sale Amount:*</label>
        <input type="number" id="createSaleAmount" name="createSaleAmount" min="0" required><br><br>
        <label for="createSaleDate">Sale Date:*</label>
        <input type="date" id="createSaleDate" name="createSaleDate" required><br><br>
        <label for="createSaleStoreId">Store ID:*</label>
        <input type="text" id="createSaleStoreId" name="createSaleStoreId" required><br><br>
        <div class="center-button">
             <button type="button" onclick="createSale()">Create Sale</button>
        </div>
    </form>

    <h2>Paginated Sales</h2>
    <form id="paginatedSalesForm">
        <label for="paginatedSalesPage">Page:</label>
        <input type="number" id="paginatedSalesPage" name="paginatedSalesPage" min="1" value="1">
        <label for="paginatedSalesPageSize">Page Size:</label>
        <input type="number" id="paginatedSalesPageSize" name="paginatedSalesPageSize" min="1" value="5"><br><br>
        <div class="center-button">
            <button type="button" onclick="paginatedSales()">Get Paginated Sales</button>
        </div>
    </form>

    <h2>Sales Leaderboard</h2>
    <form id="salesLeaderboardForm">
        <div class="center-button">
             <button type="button" onclick="salesLeaderboard()"> Get Sales Leaderboard</button>
        </div>
    </form>

    <h1>üßæ API RESPONSE LIST</h1>

    <div id="apiResponses">
    </div>

    <script>
        var today = new Date();
        var formattedDate = today.toISOString().substr(0, 10);
        document.getElementById("createSaleDate").value = formattedDate;

        //AUTHENTICATION API
        function signUp() {
                const formData = new FormData(document.getElementById('signupForm'));
                const userData = {};
                formData.forEach((value, key) => {
                    userData[key] = value;
                });

                fetch('http://localhost:3000/signup', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(userData)
                })
                .then(response => response.json())
                .then(data => {
                    displayResponse('Sign Up', data, data.status == 'ERROR');
                })
                .catch(error => {
                    console.error('Error:', error);
                    displayResponse('Sign Up', { error: error.message }, true);
                });
            }

        function login() {
                const formData = new FormData(document.getElementById('logInForm'));

                const emailLogin = document.getElementById('EmailLogin').value;
                const passwordLogin = document.getElementById('PasswordLogin').value;

                fetch('http://localhost:3000/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ Email : emailLogin, Password : passwordLogin})
                })
                .then(response => response.json())
                .then(data => {
                    if(data.status != 'ERROR')
                       document.cookie = `token=${data.response}`;
                    displayResponse('Sign In', data, data.status == 'ERROR');
                })
                .catch(error => {
                    console.error('Error:', error);
                    displayResponse('Sign In', { error: error.message }, true);
                });
            }

        function logout() {
            if(!getToken())
            {
               displayResponse('Logout', { error: 'You are not logged in!' }, true); 
               return;
            }

            fetch('http://localhost:3000/logout', {
                method: 'POST',
                headers: {
                        'Content-Type': 'application/json'
                    }
            })
            .then(response => response.json())
            .then(data => {
                displayResponse('Logout', data, data.status == 'ERROR');
                document.cookie = "token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
            })
            .catch(error => {
                console.error('Error:', error);
                displayResponse('Logout', { error: error.message }, true);
            });
        }

        //STORE API

        function insertStore() {
            const storeName = document.getElementById('insertStoreName').value;
            const storeCity = document.getElementById('insertStoreCity').value;

            fetch('http://localhost:3000/addStore', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `${getToken()}`
                },
                body: JSON.stringify({ Name: storeName, City : storeCity })
            })
            .then(response => response.json())
            .then(data => {
                displayResponse('Insert Store', data, data.status == 'ERROR');
            })
            .catch(error => {
                console.error('Error:', error);
                displayResponse('Insert Store', { error: error.message }, true);
            });
        }

        function updateStore() {
            const storeId = document.getElementById('updateStoreId').value;
            const storeName = document.getElementById('updateStoreName').value;
            const storeCity = document.getElementById('updateStoreCity').value;

            fetch(`http://localhost:3000/updateStore`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `${getToken()}`
                },
                body: JSON.stringify({ Id: storeId, Name : storeName, City : storeCity })
            })
            .then(response => response.json())
            .then(data => {
                displayResponse('Update Store', data, data.status == 'ERROR');
            })
            .catch(error => {
                console.error('Error:', error);
                displayResponse('Update Store', { error: error.message }, true);
            });
        }

        function deleteStore() {
            const storeId = document.getElementById('deleteStoreId').value;

            fetch(`http://localhost:3000/deleteStore`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `${getToken()}`
                },
                body: JSON.stringify({ Id: storeId })
            })
            .then(response => {
                if (response.ok) {
                    return response.json();
                } else {
                    throw new Error('Failed to delete store');
                }
            })
            .then(data => {
                displayResponse('Delete Store', data, data.status == 'ERROR');
            })
            .catch(error => {
                console.error('Error:', error);
                displayResponse('Delete Store', { error: error.message }, true);
            });
        }

        function findOneStore() {
            const storeId = document.getElementById('findOneStoreId').value;

            fetch(`http://localhost:3000/getStore?Id=${storeId}`, {
                method: 'GET',
                headers: {
                    'Authorization': `${getToken()}`
                }
            })
            .then(response => response.json())
            .then(data => {
                displayResponse('Find One Store', data, data.status == 'ERROR');
            })
            .catch(error => {
                console.error('Error:', error);
                displayResponse('Find One Store', { error: error.message }, true);
            });
        }

        function paginatedStores() {
            const page = document.getElementById('paginatedStoresPage').value;
            const pageSize = document.getElementById('paginatedStoresSize').value;
            const storeName = document.getElementById('paginatedStoresName').value;
            const storeCity = document.getElementById('paginatedStoresCity').value;

            const url = new URL('http://localhost:3000/getStores');
    
            if (page) {
                url.searchParams.append('Page', page);
            }
            if (pageSize) {
                url.searchParams.append('PageSize', pageSize);
            }
            if (storeName) {
                url.searchParams.append('Name', storeName);
            }
            if (storeCity) {
                url.searchParams.append('City', storeCity);
            }

            fetch(url, {
                method: 'GET',
                headers: {
                    'Authorization': `${getToken()}`
                }
            })
            .then(response => response.json())
            .then(data => {
                displayResponse('Paginated Stores', data, data.status == 'ERROR');
            })
            .catch(error => {
                console.error('Error:', error);
                displayResponse('Paginated Stores', { error: error.message }, true);
            });
        }

        //SALE API

        function createSale() {
                const storeId = document.getElementById('createSaleStoreId').value;
                const totalAmount = document.getElementById('createSaleAmount').value;
                const saleDate = document.getElementById('createSaleDate').value;

                fetch('http://localhost:3000/addSale', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `${getToken()}`
                    },
                    body: JSON.stringify({Store_id : storeId, Total_amount : totalAmount, Sale_date : saleDate})
                })
                .then(response => response.json())
                .then(data => {
                    displayResponse('Create Sale', data, data.status == 'ERROR');
                })
                .catch(error => {
                    console.error('Error:', error);
                    displayResponse('Create Sale', { error: error.message }, true);
                });
            }
            
        function paginatedSales() {
            const page = document.getElementById('paginatedSalesPage').value;
            const pageSize = document.getElementById('paginatedSalesPageSize').value;

            const url = new URL('http://localhost:3000/getSales');
    
            if (page) {
                url.searchParams.append('Page', page);
            }
            if (pageSize) {
                url.searchParams.append('PageSize', pageSize);
            }

            fetch(url, {
                method: 'GET',
                headers: {
                    'Authorization': `${getToken()}`
                }
            })
            .then(response => response.json())
            .then(data => {
                displayResponse('Paginated Stores', data, data.status == 'ERROR');
            })
            .catch(error => {
                console.error('Error:', error);
                displayResponse('Paginated Stores', { error: error.message }, true);
            });
        }

        function salesLeaderboard() {
                fetch('http://localhost:3000/leaderboard', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `${getToken()}`
                    }
                })
                .then(response => response.json())
                .then(data => {
                    displayResponse('Sales Leaderboard', data, data.status == 'ERROR');
                })
                .catch(error => {
                    console.error('Error:', error);
                    displayResponse('Sales Leaderboard', { error: error.message }, true);
                });
            }

        function getToken() {
                const cookies = document.cookie.split(';').map(cookie => cookie.trim());
                for (const cookie of cookies) {
                    const [name, value] = cookie.split('=');
                    if (name === 'token') {
                        return value;
                    }
                }
                return '';
            }

        //GENERAL FUNCTIONS

        function clearDatabase() {
                if(!confirm('This operation will empty the database. Are you sure?'))
                   return

                fetch('http://localhost:3000/clearDatabase', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    displayResponse('Clear database', data, data.status == 'ERROR');
                })
                .catch(error => {
                    console.error('Error:', error);
                    displayResponse('Clear database', { error: error.message }, true);
                });
            }

            function exportDatabase() {
                fetch('http://localhost:3000/exportDatabase', {
                    method: 'GET'
                })
                .then(response => {
                    return response.blob();
                })
                .then(blob => {
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'dbExport.json'; 
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);    
                    displayResponse('Export database', { response: ' in the project folder', status: 'OK' }, false);
                })
                .catch(error => {
                    console.error('Error:', error);
                    displayResponse('Export database', { error: error.message }, true);
                });
            }

        function displayResponse(endpoint, data, isError) {
                const responseDiv = document.createElement('div');
                responseDiv.classList.add('alert-box');

                if (isError) {
                    responseDiv.classList.add('error');
                }

                responseDiv.innerHTML = `<h3>${endpoint} Response</h3><pre>${JSON.stringify(data, null, 2)}</pre>`;
                
                document.body.appendChild(responseDiv);
                
                setTimeout(() => {
                    responseDiv.remove();
                }, 5000);
                
                const apiResponseDiv = document.createElement('div');
                apiResponseDiv.innerHTML = `<h3>${endpoint} Response</h3><pre>${JSON.stringify(data, null, 2)}</pre>`;
                document.getElementById('apiResponses').appendChild(apiResponseDiv);
            }
    </script>
</body>
</html>
